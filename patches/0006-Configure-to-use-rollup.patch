From 3a2eebfcd119ea6c02496791637ad4588918fed5 Mon Sep 17 00:00:00 2001
From: Adam Ratcliffe <adam.ratcliffe@tomtom.com>
Date: Fri, 8 Nov 2024 11:33:23 -0800
Subject: [PATCH 06/22] Configure to use rollup.

---
 .babelrc          |  3 +++
 .gitignore        |  2 +-
 package.json      | 21 +++++++++++++++++++--
 rollup.config.mjs | 35 +++++++++++++++++++++++++++++++++++
 src/index.js      |  1 +
 5 files changed, 59 insertions(+), 3 deletions(-)
 create mode 100644 .babelrc
 create mode 100644 rollup.config.mjs
 create mode 100644 src/index.js

diff --git a/.babelrc b/.babelrc
new file mode 100644
index 0000000..2b7bafa
--- /dev/null
+++ b/.babelrc
@@ -0,0 +1,3 @@
+{
+  "presets": ["@babel/preset-env", "@babel/preset-react"]
+}
diff --git a/.gitignore b/.gitignore
index 4eca06b..f8b5cba 100755
--- a/.gitignore
+++ b/.gitignore
@@ -7,7 +7,7 @@
 **/generated
 
 # output directory
-/out
+/dist
 
 # msbuild output directories
 /bin
diff --git a/package.json b/package.json
index 550932a..6f57ae2 100755
--- a/package.json
+++ b/package.json
@@ -2,7 +2,12 @@
   "name": "tomtom-navigation-js",
   "version": "1.0.0",
   "description": "TomTom navigation component for Javascript.",
-  "scripts": {},
+  "main": "dist/index.cjs.js",
+  "module": "dist/index.esm.js",
+  "scripts": {
+    "build": "rollup -c",
+    "prepare": "yarn build"
+  },
   "dependencies": {
     "@deck.gl/core": "^8.9.32",
     "@deck.gl/extensions": "^8.9.32",
@@ -26,6 +31,7 @@
     "lodash.isnumber": "^3.0.3",
     "lodash.merge": "^4.6.2",
     "lodash.pick": "^4.4.0",
+    "prop-types": "^15.8.1",
     "react-geolocated": "^4.1.2",
     "react-localization": "^1.0.19",
     "react-redux": "^8.1.3",
@@ -34,7 +40,18 @@
     "react-usestateref": "^1.0.8",
     "uuid": "^9.0.1"
   },
-  "devDependencies": {},
+  "devDependencies": {
+    "@babel/core": "^7.26.0",
+    "@babel/preset-env": "^7.26.0",
+    "@babel/preset-react": "^7.25.9",
+    "@rollup/plugin-babel": "^6.0.4",
+    "@rollup/plugin-commonjs": "^28.0.1",
+    "@rollup/plugin-json": "^6.1.0",
+    "@rollup/plugin-node-resolve": "^15.3.0",
+    "rollup": "^4.24.4",
+    "rollup-plugin-peer-deps-external": "^2.2.4",
+    "rollup-plugin-terser": "^7.0.2"
+  },
   "peerDependencies": {
     "@tomtom-international/web-sdk-maps": "^6.0.0",
     "@tomtom-international/web-sdk-services": "^6.0.0",
diff --git a/rollup.config.mjs b/rollup.config.mjs
new file mode 100644
index 0000000..89ae5dd
--- /dev/null
+++ b/rollup.config.mjs
@@ -0,0 +1,35 @@
+import babel from "@rollup/plugin-babel";
+import resolve from "@rollup/plugin-node-resolve";
+import commonjs from "@rollup/plugin-commonjs";
+import json from "@rollup/plugin-json";
+import peerDepsExternal from "rollup-plugin-peer-deps-external";
+
+export default {
+  input: "src/index.js",
+  output: [
+    {
+      file: "dist/index.cjs.js",
+      format: "cjs",
+      sourcemap: true
+    },
+    {
+      file: "dist/index.esm.js",
+      format: "esm",
+      sourcemap: true
+    }
+  ],
+  plugins: [
+    peerDepsExternal(),
+    // resolve({
+    //   extensions: [".js", ".jsx"]
+    // }),
+    babel({
+      exclude: "node_modules/**",
+      presets: ["@babel/preset-react"],
+      babelHelpers: "bundled",
+      extensions: [".js", ".jsx"]
+    }),
+    commonjs(),
+    json()
+  ]
+};
diff --git a/src/index.js b/src/index.js
new file mode 100644
index 0000000..cc34561
--- /dev/null
+++ b/src/index.js
@@ -0,0 +1 @@
+export { default as App } from "./app/App";
-- 
2.39.5 (Apple Git-154)

