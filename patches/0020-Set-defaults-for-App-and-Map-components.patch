From e9ad8f114aca4515555b2b4a5baabd9c887a8336 Mon Sep 17 00:00:00 2001
From: Adam Ratcliffe <adam.ratcliffe@tomtom.com>
Date: Sun, 10 Nov 2024 16:46:27 -0800
Subject: [PATCH 20/22] Set defaults for App and Map components.

---
 jsconfig.json           |  5 +++++
 package.json            |  4 ++--
 src/app/App.js          |  5 +++--
 src/app/AppContext.js   |  2 +-
 src/features/map/Map.js | 28 +++++++++++++++-------------
 5 files changed, 26 insertions(+), 18 deletions(-)
 create mode 100644 jsconfig.json

diff --git a/jsconfig.json b/jsconfig.json
new file mode 100644
index 0000000..738e8a4
--- /dev/null
+++ b/jsconfig.json
@@ -0,0 +1,5 @@
+{
+  "compilerOptions": {
+    "baseUrl": "./src"
+  }
+}
diff --git a/package.json b/package.json
index 413d22c..286ca71 100755
--- a/package.json
+++ b/package.json
@@ -10,7 +10,7 @@
   },
   "type": "module",
   "scripts": {
-    "build": "rollup -c",
+    "build": "rollup -cw",
     "prepare": "yarn build"
   },
   "dependencies": {
@@ -70,4 +70,4 @@
     "worker_threads": false,
     "react-dom/server": false
   }
-}
+}
\ No newline at end of file
diff --git a/src/app/App.js b/src/app/App.js
index 6759243..0d694b2 100644
--- a/src/app/App.js
+++ b/src/app/App.js
@@ -9,6 +9,7 @@ import Map from "../features/map/Map";
 import Navigation from "../features/navigation/Navigation";
 import GeolocationDialog from "./GeolocationDialog";
 import getSectionTypesForTravelMode from "../functions/getSectionTypesForTravelMode";
+import detectColorScheme from "../functions/detectColorScheme";
 import { lightTheme, darkTheme } from "./themes";
 import strings from "../config/strings";
 
@@ -29,7 +30,7 @@ import {
 
 function App({
   apiKey,
-  theme,
+  theme = detectColorScheme(),
   language = "en-US",
   measurementSystem,
   width,
@@ -40,7 +41,7 @@ function App({
   mapOptions,
   initialCenter,
   initialZoom,
-  routeOptions,
+  routeOptions = {},
   automaticRouteCalculation,
   showBottomPanel,
   showGuidancePanel,
diff --git a/src/app/AppContext.js b/src/app/AppContext.js
index 19b55a8..a5ca708 100644
--- a/src/app/AppContext.js
+++ b/src/app/AppContext.js
@@ -1,4 +1,4 @@
-import { createContext, useContext, useMemo, useState } from "react";
+import React, { createContext, useContext, useMemo, useState } from "react";
 import strings from "../config/strings";
 
 const AppContext = createContext();
diff --git a/src/features/map/Map.js b/src/features/map/Map.js
index c5ca73d..5d353fd 100644
--- a/src/features/map/Map.js
+++ b/src/features/map/Map.js
@@ -73,17 +73,17 @@ const before = "Borders - Treaty label";
 const easing = (v) => v;
 
 const Map = ({
-  enableGeolocation,
-  showTrafficFlow,
-  showTrafficIncidents,
-  showPoi,
-  showLocationMarker,
-  showMapSwitcherControl,
-  showMuteControl,
-  showExitControl,
-  showZoomControl,
-  showSkipControl,
-  showManeuverArrows,
+  enableGeolocation = true,
+  showTrafficFlow = false,
+  showTrafficIncidents = false,
+  showPoi = false,
+  showLocationMarker = true,
+  showMapSwitcherControl = true,
+  showMuteControl = true,
+  showExitControl = false,
+  showZoomControl = false,
+  showSkipControl = false,
+  showManeuverArrows = true,
   onRouteCalculated = () => {},
   onComponentExit = () => {},
   children
@@ -228,8 +228,10 @@ const Map = ({
   };
 
   const handleMapLoad = (map) => {
-    const control = map.getAttributionControl();
-    map.removeControl(control);
+    try {
+      const control = map.getAttributionControl();
+      map.removeControl(control);
+    } catch (e) {}
   };
 
   const handleGeolocationControlClick = (coords) => {
-- 
2.39.5 (Apple Git-154)

